# âœï¸ 14ì£¼ì°¨ \[8ê¸°\] Bë°˜ ìŠ¤í„°ë””

## ğŸ—“2023-04-15

**ì°¸ì—¬ì** : ë¦¬ì§€, vetto, ì†¡ì¤€, Harry, brody

**ì§„í–‰ì** : ë¦¬ì§€


## \[ê¸ˆì£¼ì˜ ì‹¤í—˜ğŸ”¥\] CoreData

### ğŸ‘¨â€ğŸ”¬ ì‹¤í—˜ 1: CoreDataë¡œ ë°ì´í„° ìƒì„±í•˜ê³  ë¶ˆëŸ¬ì˜¤ê¸°

- CoreData íŒŒì¼ ìƒì„± 
- Entity, attribute ì¶”ê°€
- ì¸ìŠ¤í™í„°ì˜ Codegen ì„ Manual/None ìœ¼ë¡œ ì„¤ì •
- xcode -> Editor -> create NSManagedObjectë¡œ íŒŒì¼ ìƒì„±

### ëª¨ë¸
``` swift
enum Category: Int {
    case ìœ í–‰ì–´
    case ì•„ì¬ê°œê·¸
    
    var description: String {
        switch self {
        case .ìœ í–‰ì–´:
            return "ìœ í–‰ì–´"
        case .ì•„ì¬ê°œê·¸:
            return "ì•„ì¬ê°œê·¸"
        }
    }
}

struct JokeModel: Identifiable {
    let content: String
    let category: Category
    let id = UUID()
}
```

### ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°, ì €ì¥í•˜ê¸°
```swift
class PersistenceManager {
    static var shared: PersistenceManager = PersistenceManager()
    
    ...
    
    func fetch<T: NSManagedObject>(request: NSFetchRequest<T>) -> [T] {
        do {
            let fetchResult = try self.context.fetch(request)
            return fetchResult
        } catch {
            print(error.localizedDescription)
            return []
        }
    }
    
    @discardableResult
    func insertJoke(joke: JokeModel) -> Bool {
        let entity = NSEntityDescription.entity(forEntityName: "Joke", in: self.context)
        
        if let entity = entity {
            let managedObject = NSManagedObject(entity: entity, insertInto: self.context)
            
            managedObject.setValue(joke.category.description, forKey: "category")
            managedObject.setValue(joke.content, forKey: "body")
            managedObject.setValue(joke.id, forKey: "id")
            
            do {
                try self.context.save()
                return true
            } catch {
                print(error.localizedDescription)
                return false
            }
        } else {
            return false
        }
    }
```

<br>
<br>

### ğŸ‘¨â€ğŸ”¬ ì‹¤í—˜ 2: FetchRequestë¥¼ ì¡°ì‘í•´ ì›í•˜ëŠ” ì •ë³´ë§Œì„ ë¶ˆëŸ¬ì˜¤ê¸°
- CoreData Delete êµ¬í˜„
- CoreDataë¥¼ ë°›ì•„ì˜¤ëŠ” ì‹œì ì—ì„œ NSPredicateë¥¼ í™œìš©í•´ ë°ì´í„° ì¶”ë ¤ë‚´ê¸°
- TabBarControllerë¥¼ í™œìš©í•˜ì—¬ í™”ë©´ ë¶„ë¦¬

### ëª¨ë¸ì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì´ìš©í•´ ì›í•˜ëŠ” ì •ë³´ë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
```swift
let request: NSFetchRequest<Joke> = Joke.fetchRequest()
guard let category = category?.description else { return }
let predicate = NSPredicate(format: "category == %@", category)
request.predicate = predicate

data = PersistenceManager.shared.fetch(request: request)
```

### ëª¨ë¸ì˜ idë¥¼ ë¹„êµí•´ CoreDataì— ì €ì¥ëœ ë°ì´í„° ì‚­ì œí•˜ê¸°

``` swift
@discardableResult
func deleteJoke(jokeID: String) -> Bool {
    do {
        let request: NSFetchRequest<Joke> = Joke.fetchRequest()
        let predicate = NSPredicate(format: "id == %@", jokeID)
        request.predicate = predicate

        let fetchResult = try self.context.fetch(request)[0]
        self.context.delete(fetchResult)
        try context.save()

        return true

    } catch {
        print(error.localizedDescription)
        return false
    }
}
```

``` swift
func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath) {
    if editingStyle == .delete {
        guard let id = data[indexPath.row].id?.description else { return }

        if PersistenceManager.shared.deleteJoke(jokeID: id) {
            data.remove(at: indexPath.row)
            tableView.deleteRows(at: [indexPath], with: .automatic)
        }
    }
}
```

<br>

## ì–´ë ¤ì› ë˜ ì 
### íƒ­ë°”ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë³´ì—¬ì£¼ëŠ” ê°ê°ì˜ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ë¡œ ì •ì˜
- ì•„ì¬ê°œê·¸ íƒ­ì—ì„œ ëª¨ë‹¬ì°½ì„ ë„ì›Œ ì•„ë¬´ë§ì„ ìœ í–‰ì–´ íƒ€ì…ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ ìœ í–‰ì–´ íƒ­ì—ì„œ ë°”ë¡œ í…Œì´ë¸”ë·°ì— ì¶”ê°€ëœ ì•„ë¬´ë§ í–‰ì´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ” í˜„ìƒì´ ìˆì—ˆìŠµë‹ˆë‹¤.
- ê¸°ì¡´ì— delegateë¥¼ í†µí•´ ì½”ì–´ë°ì´í„°ì˜ ë°ì´í„°ë¥¼ fetch í–ˆì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹¤í–‰ì‹œê°„ì— delegateê°€ í•˜ë‚˜ì˜ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ íŠ¹ì •í•˜ê³  ìˆê³ , ë‹¤ë¥¸ ë·°ì»¨ì—ì„œ ë„ìš´ ëª¨ë‹¬ì°½ì—ì„œ ì €ì¥ ì‘ì—…ì„ í•˜ë©´ í•´ë‹¹ ë·°ì»¨ì˜ ì¹´í…Œê³ ë¦¬(ìœ í–‰ì–´, ì•„ì¬ê°œê·¸)ë§Œ ë°”ë¡œ ë°ì´í„°ë¥¼ ìµœì‹ í™”í•˜ê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ ë‘ ê°œì˜ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ê°ê° fetchë¥¼ í•˜ê²Œ í•˜ê¸° ìœ„í•´ viewWillAppear() ë©”ì„œë“œ ë‚´ì—ì„œ ì½”ì–´ë°ì´í„°ì˜ ë°ì´í„°ë¥¼ fetchí•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°




